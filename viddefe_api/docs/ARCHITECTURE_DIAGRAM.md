# ğŸ—ï¸ DIAGRAMA DE ARQUITECTURA - NORMALIZACIÃ“N DE MEETINGS

## Arquitectura General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENTE (Frontend)                             â”‚
â”‚  Input: Local time + Timezone (ej: 2026-01-15T10:00:00-05:00)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REST API (Controllers)                              â”‚
â”‚  /api/v1/worship-meetings                                            â”‚
â”‚  /api/v1/group-meetings                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION LAYER (Servicios)                     â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  WorshipServicesImpl  â”‚  â”‚GroupMeetingServiceImplâ”‚                 â”‚
â”‚  â”‚  (Refactorizado)     â”‚  â”‚  (Refactorizado)     â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                         â”‚                                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â–¼                                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚         â”‚   MeetingService (NEW)  â”‚                                 â”‚
â”‚         â”‚  - create()             â”‚                                 â”‚
â”‚         â”‚  - update()             â”‚                                 â”‚
â”‚         â”‚  - findById()           â”‚                                 â”‚
â”‚         â”‚  - findByContextIdAnd   â”‚                                 â”‚
â”‚         â”‚    Type()               â”‚                                 â”‚
â”‚         â”‚  - delete()             â”‚                                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                       â”‚                                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚  MeetingTypeConfigService (NEW)     â”‚                     â”‚
â”‚         â”‚  - findByMeetingType()              â”‚                     â”‚
â”‚         â”‚  - findByTypeAndSubtype()           â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOMAIN LAYER (Servicios)                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ MeetingRepositoryâ”‚  â”‚ MeetingTypeConfigRepositoryâ”‚                â”‚
â”‚  â”‚     (NEW)        â”‚  â”‚        (NEW)             â”‚                 â”‚
â”‚  â”‚                  â”‚  â”‚                          â”‚                 â”‚
â”‚  â”‚findByContextId   â”‚  â”‚findByMeetingTypeEnum()   â”‚                 â”‚
â”‚  â”‚AndType()         â”‚  â”‚findByTypeAndSubtype()    â”‚                 â”‚
â”‚  â”‚findByIdWithRels()â”‚  â”‚                          â”‚                 â”‚
â”‚  â”‚existsConflict()  â”‚  â”‚                          â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                      â”‚
â”‚  (Repositories antiguos se mantienen para compatibilidad)           â”‚
â”‚  - WorshipRepository                                                 â”‚
â”‚  - GroupMeetingRepository                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOMAIN LAYER (Entidades)                          â”‚
â”‚                                                                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚        â”‚  Meeting (NEW - @Entity)         â”‚                         â”‚
â”‚        â”‚  @Table(meetings)                â”‚                         â”‚
â”‚        â”‚  @Inheritance(SINGLE_TABLE)      â”‚                         â”‚
â”‚        â”‚  @DiscriminatorColumn            â”‚                         â”‚
â”‚        â”‚  (meeting_type)                  â”‚                         â”‚
â”‚        â”‚                                  â”‚                         â”‚
â”‚        â”‚  Fields:                         â”‚                         â”‚
â”‚        â”‚  - id (UUID)                     â”‚                         â”‚
â”‚        â”‚  - name (String)                 â”‚                         â”‚
â”‚        â”‚  - description (Text)            â”‚                         â”‚
â”‚        â”‚  - scheduled_date (OffsetDT)     â”‚â—„â”€â”€â”€ NO CONVERSIONES    â”‚
â”‚        â”‚  - creation_date (Instant)       â”‚      DE ZONA           â”‚
â”‚        â”‚  - context_id (UUID)             â”‚â—„â”€â”€â”€ GenÃ©rico           â”‚
â”‚        â”‚  - type_id (Long)                â”‚â—„â”€â”€â”€ GenÃ©rico           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚         â”‚                            â”‚                              â”‚
â”‚         â–¼                            â–¼                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚ WorkshipMeeting â”‚      â”‚  GroupMeetings    â”‚                    â”‚
â”‚   â”‚    Model        â”‚      â”‚   (NEW)           â”‚                    â”‚
â”‚   â”‚@DiscriminatorV  â”‚      â”‚@DiscriminatorValueâ”‚                    â”‚
â”‚   â”‚= "WORSHIP"      â”‚      â”‚= "GROUP_MEETING"  â”‚                    â”‚
â”‚   â”‚                 â”‚      â”‚                   â”‚                    â”‚
â”‚   â”‚Methods:         â”‚      â”‚Methods:           â”‚                    â”‚
â”‚   â”‚- fromDto()      â”‚      â”‚- fromDto()        â”‚                    â”‚
â”‚   â”‚- updateFrom()   â”‚      â”‚- updateFrom()     â”‚                    â”‚
â”‚   â”‚- toDto()        â”‚      â”‚- toDto()          â”‚                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                      â”‚
â”‚  Config:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚   MeetingTypeEnum (NEW)            â”‚                            â”‚
â”‚  â”‚   - WORSHIP                        â”‚                            â”‚
â”‚  â”‚   - GROUP_MEETING                  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚   MeetingTypeConfig (NEW)          â”‚                            â”‚
â”‚  â”‚   @Table(meeting_type_configs)     â”‚                            â”‚
â”‚  â”‚   - id (UUID)                      â”‚                            â”‚
â”‚  â”‚   - meeting_type_enum              â”‚                            â”‚
â”‚  â”‚   - subtype_id (Long)              â”‚                            â”‚
â”‚  â”‚   - name (String)                  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE LAYER (PostgreSQL)                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  meetings (SINGLE_TABLE - Tabla Normalizada)               â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  Columns:                                                   â”‚    â”‚
â”‚  â”‚  - id (UUID) PRIMARY KEY                                    â”‚    â”‚
â”‚  â”‚  - meeting_type VARCHAR(50) â—„â”€â”€â”€ DISCRIMINADOR            â”‚    â”‚
â”‚  â”‚  - name VARCHAR(255)                                        â”‚    â”‚
â”‚  â”‚  - description TEXT                                         â”‚    â”‚
â”‚  â”‚  - scheduled_date TIMESTAMPTZ â—„â”€â”€â”€ UTC STORAGE            â”‚    â”‚
â”‚  â”‚  - creation_date TIMESTAMPTZ â—„â”€â”€â”€ UTC                      â”‚    â”‚
â”‚  â”‚  - context_id UUID â—„â”€â”€â”€ iglesia o grupo                    â”‚    â”‚
â”‚  â”‚  - type_id BIGINT â—„â”€â”€â”€ tipo genÃ©rico                       â”‚    â”‚
â”‚  â”‚  - worship_meeting_type_id BIGINT FK (nullable)            â”‚    â”‚
â”‚  â”‚  - group_meeting_type_id BIGINT FK (nullable)              â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  INDICES:                                                   â”‚    â”‚
â”‚  â”‚  - idx_meetings_context_id                                 â”‚    â”‚
â”‚  â”‚  - idx_meetings_type_id                                    â”‚    â”‚
â”‚  â”‚  - idx_meetings_meeting_type                               â”‚    â”‚
â”‚  â”‚  - idx_meetings_scheduled_date                             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  CONSTRAINTS:                                               â”‚    â”‚
â”‚  â”‚  - uk_context_type_scheduled UNIQUE                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  meeting_type_configs (Tabla de ConfiguraciÃ³n)             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  Columns:                                                   â”‚    â”‚
â”‚  â”‚  - id (UUID) PRIMARY KEY                                    â”‚    â”‚
â”‚  â”‚  - meeting_type_enum VARCHAR(50)                            â”‚    â”‚
â”‚  â”‚  - subtype_id BIGINT                                        â”‚    â”‚
â”‚  â”‚  - name VARCHAR(255)                                        â”‚    â”‚
â”‚  â”‚  - description TEXT                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  worship_meeting_types (Tabla Existente - Mantenida)       â”‚    â”‚
â”‚  â”‚  group_meeting_types (Tabla Existente - Mantenida)         â”‚    â”‚
â”‚  â”‚  worship_services (Tabla Antigua - AuditorÃ­a)              â”‚    â”‚
â”‚  â”‚  group_meetings (Tabla Antigua - AuditorÃ­a)                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPUESTA AL CLIENTE                              â”‚
â”‚  Output: UTC (ej: 2026-01-15T15:00:00Z)                             â”‚
â”‚  Frontend: Convierte a hora local para display                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Timezone

```
ENTRADA (Frontend)
  â””â”€ Local: 2026-01-15T10:00:00-05:00
       â†“
  Jackson deserializa
       â†“
  OffsetDateTime (preserva offset)
       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Backend (WorshipMeeting â”‚
  â”‚    Model.fromDto())       â”‚
  â”‚  âœ… SIN conversiones      â”‚
  â”‚  âœ… OffsetDateTime        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
  MeetingService.create()
       â†“
  PostgreSQL timestamptz
  â””â”€ Almacena: 2026-01-15 15:00:00 UTC
       â†“
  Jackson serializa
       â†“
  SALIDA (JSON)
  â””â”€ UTC: 2026-01-15T15:00:00Z
       â†“
  Frontend
  â””â”€ Convierte a: 2026-01-15T10:00:00-05:00 (hora local)
       â†“
  Usuario ve: "15 de Enero, 10:00 AM"
```

---

## Herencia JPA - Tabla Unificada

```
BEFORE (2 tablas separadas)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @MappedSuperclass     â”‚
â”‚  Meeting               â”‚  (no tiene tabla)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚@Table        â”‚  â”‚@Table        â”‚
â”‚worship_      â”‚  â”‚group_        â”‚
â”‚services      â”‚  â”‚meetings      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(Tabla propia)    (Tabla propia)

PROBLEMAS:
- DuplicaciÃ³n de campos
- Queries separadas
- DifÃ­cil de unificar

AFTER (1 tabla con discriminador)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @Entity                         â”‚
â”‚  @Table(meetings)                â”‚
â”‚  @Inheritance(SINGLE_TABLE)      â”‚
â”‚  @DiscriminatorColumn(meeting_   â”‚
â”‚    type)                         â”‚
â”‚  Meeting                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚@DiscriminatorValueâ”‚  â”‚@DiscriminatorValueâ”‚
â”‚("WORSHIP")       â”‚  â”‚("GROUP_MEETING") â”‚
â”‚WorshipMeeting   â”‚  â”‚GroupMeetings     â”‚
â”‚Model            â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(Subclase)           (Subclase)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tabla fÃ­sica: meetings           â”‚
â”‚ - meeting_type: WORSHIP          â”‚
â”‚ - meeting_type: GROUP_MEETING    â”‚
â”‚ Todas las filas en 1 tabla       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFICIOS:
- Sin duplicaciÃ³n
- Queries unificadas
- FÃ¡cil de escalar
```

---

## Flujo de Operaciones CRUD

### CREATE

```
POST /worship-meetings
â”œâ”€ Recibe: CreateWorshipDto (con scheduledDate + timezone)
â”œâ”€ WorshipServicesImpl.createWorship()
â”‚  â”œâ”€ Valida conflictos
â”‚  â”œâ”€ Crea WorshipMeetingModel
â”‚  â”œâ”€ Asigna contextId (churchId)
â”‚  â”œâ”€ Asigna typeId (worshipTypeId)
â”‚  â””â”€ Llama MeetingService.create()
â”œâ”€ MeetingService.create()
â”‚  â””â”€ MeetingRepository.save(worshipModel)
â”œâ”€ PostgreSQL
â”‚  â””â”€ INSERT INTO meetings (meeting_type, name, scheduled_date, ...)
â”‚     VALUES ('WORSHIP', 'Culto', '2026-01-15 15:00:00+00', ...)
â””â”€ RESPUESTA: 201 Created + WorshipDto (UTC)
```

### READ (Get by Context & Type)

```
GET /worship-meetings?churchId=xxx&page=0&size=20
â”œâ”€ WorshipServicesImpl.getAllWorships()
â”‚  â””â”€ MeetingService.findByContextIdAndType(churchId, WORSHIP, page)
â”œâ”€ MeetingRepository query
â”‚  â””â”€ SELECT * FROM meetings
â”‚     WHERE context_id = ? AND meeting_type = 'WORSHIP'
â”‚     LIMIT 20 OFFSET 0
â”œâ”€ PostgreSQL retorna
â”‚  â””â”€ Page<Meeting> (polimÃ³rficas)
â”œâ”€ Cast a WorshipMeetingModel
â”‚  â””â”€ Llama toDto()
â””â”€ RESPUESTA: 200 OK + List<WorshipDto> (UTC)
```

### UPDATE

```
PUT /worship-meetings/{id}
â”œâ”€ Recibe: CreateWorshipDto (con scheduledDate + timezone)
â”œâ”€ WorshipServicesImpl.updateWorship()
â”‚  â”œâ”€ Obtiene WorshipMeetingModel
â”‚  â”œâ”€ Valida conflictos (sin contar la reuniÃ³n actual)
â”‚  â”œâ”€ Llama updateFrom(dto)
â”‚  â”‚  â””â”€ Actualiza name, description, scheduledDate
â”‚  â””â”€ MeetingService.update()
â”œâ”€ PostgreSQL
â”‚  â””â”€ UPDATE meetings SET name=?, scheduled_date=? WHERE id=?
â””â”€ RESPUESTA: 200 OK + WorshipDto (UTC)
```

### DELETE

```
DELETE /worship-meetings/{id}
â”œâ”€ WorshipServicesImpl.deleteWorship()
â”‚  â”œâ”€ Verifica que existe
â”‚  â””â”€ MeetingService.delete(id)
â”œâ”€ PostgreSQL
â”‚  â””â”€ DELETE FROM meetings WHERE id=?
â””â”€ RESPUESTA: 204 No Content
```

---

## Consultas por Tipo

```
â”Œâ”€ Obtener TODOS los meetings de una iglesia
â”‚  SQL: SELECT * FROM meetings WHERE context_id = ?
â”‚
â”œâ”€ Obtener solo WORSHIP de una iglesia
â”‚  SQL: SELECT * FROM meetings 
â”‚       WHERE context_id = ? AND meeting_type = 'WORSHIP'
â”‚
â”œâ”€ Obtener solo GROUP_MEETING de un grupo
â”‚  SQL: SELECT * FROM meetings 
â”‚       WHERE context_id = ? AND meeting_type = 'GROUP_MEETING'
â”‚
â””â”€ Verificar conflicto (mismo tipo, hora, contexto)
   SQL: SELECT COUNT(*) FROM meetings 
        WHERE context_id = ? AND type_id = ? 
        AND scheduled_date = ? AND meeting_type = ?
   Resultado: > 0 = CONFLICTO
```

---

## Stack TecnolÃ³gico

```
â”Œâ”€ FRONTEND
â”‚  â”œâ”€ React / Vue / Angular
â”‚  â”œâ”€ TypeScript
â”‚  â”œâ”€ date-fns-tz (para timezone)
â”‚  â””â”€ Input: ISO-8601 con offset
â”‚
â”œâ”€ BACKEND (Java)
â”‚  â”œâ”€ Spring Boot 3.x
â”‚  â”œâ”€ Spring Data JPA
â”‚  â”œâ”€ Hibernate
â”‚  â”œâ”€ Jackson (JSON)
â”‚  â””â”€ OffsetDateTime (timezone)
â”‚
â””â”€ DATABASE
   â”œâ”€ PostgreSQL 12+
   â”œâ”€ TIMESTAMPTZ (timezone aware)
   â””â”€ indices y constraints
```

---

**Diagrama VersiÃ³n**: 1.0  
**Fecha**: 2026-01-16  
**Estado**: âœ… Completo

