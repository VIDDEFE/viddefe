spring.application.name=viddefe_api

server.servlet.context-path=/api/v1

# BD
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWD}
spring.datasource.driver-class-name=org.postgresql.Driver


# Hibernate migrations ON
spring.jpa.hibernate.ddl-auto=update

# APAGAR Liquibase
spring.liquibase.enabled=false

# Secrets
jwt.secret=${JWT_SECRET}
spring.security.baisc.enabled=false

# Env
spring.profiles.active=dev

logging.level.org.springframework.web=DEBUG

spring.devtools.restart.enabled=true
server.address=0.0.0.0

# SMTP
spring.mail.host=${MAIL_HOST}
spring.mail.port=${MAIL_PORT}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}

spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

#WHATSAPP
whatsapp.api.url=${WHATSAPP_API_URL}
whatsapp.api.token=${WHATSAPP_API_TOKEN}
whatsapp.api.phone.number.id=${WHATSAPP_API_PHONE_NUMBER_ID}

# Timezone Configuration - Backend always works in UTC
spring.jackson.time-zone=UTC
spring.jackson.serialization.WRITE_DATES_AS_TIMESTAMPS=false
spring.jpa.properties.hibernate.jdbc.time_zone=America/Bogota


# RabbitMQ
spring.rabbitmq.host=${RABBITMQ_HOST}
spring.rabbitmq.port=${RABBITMQ_PORT}
spring.rabbitmq.username=${RABBITMQ_USERNAME}
spring.rabbitmq.password=${RABBITMQ_PASSWORD}

# RabbitMQ Listener Configuration for resilient messaging
spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.listener.simple.retry.enabled=false

# Resilience4j Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.whatsapp-api.register-health-indicator=true
resilience4j.circuitbreaker.instances.whatsapp-api.sliding-window-size=10
resilience4j.circuitbreaker.instances.whatsapp-api.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.whatsapp-api.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.whatsapp-api.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.whatsapp-api.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.whatsapp-api.slow-call-rate-threshold=50
resilience4j.circuitbreaker.instances.whatsapp-api.slow-call-duration-threshold=2s

# Redis Configuration
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=1000ms

# Logger
logging.level.com.viddefe=DEBUG
